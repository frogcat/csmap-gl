<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>csmap-gl</title>
  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-hash@0.2.1/leaflet-hash.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="leaflet-tilelayer-csgl.js"></script>
  <style>
    #mixer {
      position: absolute;
      top: 10px;
      left: 10px;
      width: auto;
      height: auto;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      z-index: 10000;
      border-radius: 5px;
    }
  </style>
</head>

<body>
  <div id="map" style="position:absolute;top:0;left:0;bottom:0;right:0;"></div>
  <div id="mixer">
    <dl style="margin:10px;">
      <dt>curvature</dt>
      <dd><input type="range" id="curvature" min="1" max="100" value="50" /></dd>
      <dt>slope</dt>
      <dd><input type="range" id="slope" min="1" max="160" value="20" /></dd>
    </dl>
  </div>
  <script>
    var map = L.map("map", L.extend({
      zoom: 12,
      maxZoom: 14,
      center: [35.3538, 138.8279]
    }, L.Hash.parseHash(location.hash)));
    map.zoomControl.setPosition("bottomright");

    L.tileLayer("https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png", {
      attribution: "<a href='http://maps.gsi.go.jp/development/ichiran.html'>地理院タイル</a>"
    }).addTo(map);

    var layer = L.tileLayer.csgl("https://cyberjapandata.gsi.go.jp/xyz/dem_png/{z}/{x}/{y}.png?a", {
      attribution: "<a href='http://maps.gsi.go.jp/development/ichiran.html'>地理院タイル</a>",
      crossOrigin: true
    }).addTo(map);
    L.hash(map);


    $("#mixer input").on("input", function() {
      var curvature = parseFloat($("#curvature").val());
      var slope = parseFloat($("#slope").val());
      layer.options.curvature = 3.0 * curvature / 100;
      layer.options.slope = 1.0 * slope / 100;
      layer._paint();
    }).eq(1).trigger("input");
  </script>
</body>

</html>
